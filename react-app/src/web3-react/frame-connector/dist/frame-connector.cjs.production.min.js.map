{"version":3,"file":"frame-connector.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { AbstractConnectorArguments, ConnectorUpdate } from '@web3-react/types'\r\nimport { AbstractConnector } from '@web3-react/abstract-connector'\r\nimport ethProvider from 'eth-provider'\r\nimport invariant from 'tiny-invariant'\r\n\r\nexport class UserRejectedRequestError extends Error {\r\n  public constructor() {\r\n    super()\r\n    this.name = this.constructor.name\r\n    this.message = 'The user rejected the request.'\r\n  }\r\n}\r\n\r\nexport class FrameConnector extends AbstractConnector {\r\n  private provider: any\r\n\r\n  constructor(kwargs: Required<AbstractConnectorArguments>) {\r\n    invariant(kwargs.supportedChainIds.length === 1, 'This connector only supports 1 chainId at the moment.')\r\n    super(kwargs)\r\n\r\n    this.handleNetworkChanged = this.handleNetworkChanged.bind(this)\r\n    this.handleChainChanged = this.handleChainChanged.bind(this)\r\n    this.handleAccountsChanged = this.handleAccountsChanged.bind(this)\r\n    this.handleClose = this.handleClose.bind(this)\r\n  }\r\n\r\n  private handleNetworkChanged(networkId: string): void {\r\n    if (__DEV__) {\r\n      console.log(\"Handling 'networkChanged' event with payload\", networkId)\r\n    }\r\n    this.emitUpdate({ provider: this.provider, chainId: networkId })\r\n  }\r\n\r\n  private handleChainChanged(chainId: string): void {\r\n    if (__DEV__) {\r\n      console.log(\"Handling 'chainChanged' event with payload\", chainId)\r\n    }\r\n    this.emitUpdate({ chainId })\r\n  }\r\n\r\n  private handleAccountsChanged(accounts: string[]): void {\r\n    if (__DEV__) {\r\n      console.log(\"Handling 'accountsChanged' event with payload\", accounts)\r\n    }\r\n    this.emitUpdate({ account: accounts.length === 0 ? null : accounts[0] })\r\n  }\r\n\r\n  private handleClose(code: number, reason: string): void {\r\n    if (__DEV__) {\r\n      console.log(\"Handling 'close' event with payload\", code, reason)\r\n    }\r\n    this.emitDeactivate()\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    if (!this.provider) {\r\n      this.provider = ethProvider('frame')\r\n    }\r\n\r\n    this.provider\r\n      .on('networkChanged', this.handleNetworkChanged)\r\n      .on('chainChanged', this.handleChainChanged)\r\n      .on('accountsChanged', this.handleAccountsChanged)\r\n      .on('close', this.handleClose)\r\n\r\n    const account = await this.provider\r\n      .enable()\r\n      .then((accounts: string[]): string => accounts[0])\r\n      .catch((error: Error): void => {\r\n        if (error && (error as any).code === 4001) {\r\n          throw new UserRejectedRequestError()\r\n        } else {\r\n          throw error\r\n        }\r\n      })\r\n\r\n    return { provider: this.provider, account }\r\n  }\r\n\r\n  public async getProvider(): Promise<any> {\r\n    return this.provider\r\n  }\r\n\r\n  public async getChainId(): Promise<number> {\r\n    return this.provider.send('eth_chainId')\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return this.provider.send('eth_accounts').then((accounts: string[]): string => accounts[0])\r\n  }\r\n\r\n  public deactivate() {\r\n    this.provider\r\n      .removeListener('networkChanged', this.handleNetworkChanged)\r\n      .removeListener('chainChanged', this.handleChainChanged)\r\n      .removeListener('accountsChanged', this.handleAccountsChanged)\r\n      .removeListener('close', this.handleClose)\r\n  }\r\n}\r\n"],"names":["UserRejectedRequestError","name","_this","constructor","message","Error","kwargs","supportedChainIds","length","invariant","handleNetworkChanged","_this2","bind","handleChainChanged","handleAccountsChanged","handleClose","networkId","emitUpdate","provider","this","chainId","accounts","account","code","reason","emitDeactivate","activate","_this4","ethProvider","on","enable","then","error","getProvider","getChainId","send","getAccount","deactivate","removeListener","AbstractConnector"],"mappings":"mhDAKaA,8DAGJC,KAAOC,EAAKC,YAAYF,OACxBG,QAAU,sDAJ2BC,sDAWhCC,gBACoC,IAApCA,EAAOC,kBAAkBC,QAAnCC,qBACMH,UAEDI,qBAAuBC,EAAKD,qBAAqBE,aACjDC,mBAAqBF,EAAKE,mBAAmBD,aAC7CE,sBAAwBH,EAAKG,sBAAsBF,aACnDG,YAAcJ,EAAKI,YAAYH,+CAG9BF,qBAAA,SAAqBM,QAItBC,WAAW,CAAEC,SAAUC,KAAKD,SAAUE,QAASJ,OAG9CH,mBAAA,SAAmBO,QAIpBH,WAAW,CAAEG,QAAAA,OAGZN,sBAAA,SAAsBO,QAIvBJ,WAAW,CAAEK,QAA6B,IAApBD,EAASb,OAAe,KAAOa,EAAS,QAG7DN,YAAA,SAAYQ,EAAcC,QAI3BC,oBAGMC,8BACNP,YAAAQ,EAAKT,aACHA,SAAWU,EAAY,YAGzBV,SACFW,GAAG,iBAAkBF,EAAKjB,sBAC1BmB,GAAG,eAAgBF,EAAKd,oBACxBgB,GAAG,kBAAmBF,EAAKb,uBAC3Be,GAAG,QAASF,EAAKZ,6BAEEY,EAAKT,SACxBY,SACAC,MAAK,SAACV,UAA+BA,EAAS,aACxC,SAACW,SACFA,GAAiC,OAAvBA,EAAcT,KACpB,IAAIvB,EAEJgC,qBAPNV,SAWC,CAAEJ,SAAUS,EAAKT,SAAUI,QAAAA,4CAGvBW,kDACJd,KAAKD,gDAGDgB,iDACJf,KAAKD,SAASiB,KAAK,sDAGfC,iDACJjB,KAAKD,SAASiB,KAAK,gBAAgBJ,MAAK,SAACV,UAA+BA,EAAS,6CAGnFgB,WAAA,gBACAnB,SACFoB,eAAe,iBAAkBnB,KAAKT,sBACtC4B,eAAe,eAAgBnB,KAAKN,oBACpCyB,eAAe,kBAAmBnB,KAAKL,uBACvCwB,eAAe,QAASnB,KAAKJ,iBAnFAwB"}